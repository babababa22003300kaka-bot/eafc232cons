# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘              ğŸ¤– BOT APPLICATION FACTORY                                  â•‘
# â•‘              Ù…ØµÙ†Ø¹ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙˆØª - Ù…Ø¹ Persistence                          â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"""
Ù…ØµÙ†Ø¹ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙˆØª
- ØªÙØ¹ÙŠÙ„ PicklePersistence
- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©
"""

from pathlib import Path

from telegram.ext import Application, PicklePersistence

from config import BOT_TOKEN


class FC26BotApp:
    """Ù…ØµÙ†Ø¹ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙˆØª"""

    def create_application(self):
        """
        Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙˆØª Ù…Ø¹ ØªÙØ¹ÙŠÙ„ Persistence

        Returns:
            Application: ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙˆØª Ø¬Ø§Ù‡Ø²
        """
        print("\nğŸ¤– [BOT-APP] Creating application with persistence...")

        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # 1ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ data/ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        data_dir = Path("data")
        data_dir.mkdir(parents=True, exist_ok=True)
        print(f"   ğŸ“ Data directory ready: {data_dir}")

        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # 2ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† PicklePersistence
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        session_file = data_dir / "sessions.pkl"

        persistence = PicklePersistence(
            filepath=str(session_file),
            update_interval=60,  # Ø­ÙØ¸ ÙƒÙ„ 60 Ø«Ø§Ù†ÙŠØ©
        )
        print(f"   ğŸ’¾ Persistence configured: {session_file}")
        print(f"   â±ï¸ Update interval: 60 seconds")

        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # 3ï¸âƒ£ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹ Persistence
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        app = (
            Application.builder()
            .token(BOT_TOKEN)
            .persistence(persistence)  # ğŸ”¥ ØªÙØ¹ÙŠÙ„ Persistence
            .build()
        )

        print(f"   âœ… Application created successfully")
        print(f"   ğŸ”¥ Persistence ENABLED")
        print()

        return app
